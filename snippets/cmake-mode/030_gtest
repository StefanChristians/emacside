# -*- mode: snippet -*-
# name: gtest
# group: module
# --
include_guard(GLOBAL)

# Use GoogleTest testing framework.

# GoogleTest must be compiled with the same flags as the source code
# to work properly, so the system-installed binary version can not
# be used.

# download gtest and gmock
FetchContent_Declare_Persist(
  googletest
  GIT_REPOSITORY "https://github.com/google/googletest.git"
  GIT_TAG "latest"
  GIT_PROGRESS ON
  GIT_SHALLOW ON
)

# do not install GoogleTest in the distribution target
set(INSTALL_GTEST OFF CACHE BOOL "" FORCE)

# To avoid harmless but irritating warnings about policy CMP0069,
# run this BEFORE INTERPROCEDURAL_OPTIMIZATION is turned on.
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)

FetchContent_MakeAvailable(googletest)

# activate CMake GoogleTest module
# (provides gtest_discover_tests() function)
include(GoogleTest)
